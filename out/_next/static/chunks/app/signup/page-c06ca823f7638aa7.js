(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[966],{2700:function(e,r,t){"use strict";t.d(r,{Z:function(){return a}});var i=t(5531);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,i.Z)("Baby",[["path",{d:"M9 12h.01",key:"157uk2"}],["path",{d:"M15 12h.01",key:"1k8ypt"}],["path",{d:"M10 16c.5.3 1.2.5 2 .5s1.5-.2 2-.5",key:"1u7htd"}],["path",{d:"M19 6.3a9 9 0 0 1 1.8 3.9 2 2 0 0 1 0 3.6 9 9 0 0 1-17.6 0 2 2 0 0 1 0-3.6A9 9 0 0 1 12 3c2 0 3.5 1.1 3.5 2.5s-.9 2.5-2 2.5c-.8 0-1.5-.4-1.5-1",key:"5yv0yz"}]])},3715:function(e,r,t){"use strict";t.d(r,{Z:function(){return a}});var i=t(5531);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,i.Z)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},3206:function(e,r,t){Promise.resolve().then(t.bind(t,9961))},9961:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return b}});var i=t(7437),a=t(2265),n=t(4033),s=t(7430),o=t(8110),l=t(1865),c=t(4578),d=t(3715),u=t(3067),m=t(2700),f=t(3023),p=t(1315),h=t(1908),x=t(2621),v=t(6763),w=t(9311),g=t(4566);let j=(0,g.eI)("https://xuqkgeusasosxtcfhbwj.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inh1cWtnZXVzYXNvc3h0Y2ZoYndqIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTczNjMwODU5NSwiZXhwIjoyMDUxODg0NTk1fQ.mDgADwthCJGMesU6F6-ui9XfLw7DGoA06k66mGEAGKU",{auth:{autoRefreshToken:!0,persistSession:!1},db:{schema:"public"}}),y=c.Ry({name:c.Z_().min(2,"Name must be at least 2 characters"),email:c.Z_().email("Please enter a valid email address"),password:c.Z_().min(8,"Password must be at least 8 characters").regex(/[A-Z]/,"Password must contain at least one uppercase letter").regex(/[a-z]/,"Password must contain at least one lowercase letter").regex(/[0-9]/,"Password must contain at least one number"),confirmPassword:c.Z_()}).refine(e=>e.password===e.confirmPassword,{message:"Passwords don't match",path:["confirmPassword"]});function b(){let e=(0,n.useRouter)(),r=(0,n.useSearchParams)(),{toast:t}=(0,x.pm)(),[c,g]=(0,a.useState)(!1),[b,I]=(0,a.useState)(!0),[N,C]=(0,a.useState)(null),[_,E]=(0,a.useState)(null),[k,P]=(0,a.useState)(""),S=r.get("invitation_id"),R=S&&(0,w.z)(S)?S:null,Z=r.get("email");(0,a.useEffect)(()=>{P(window.location.href)},[]),(0,a.useEffect)(()=>(w.f.info("CaregiverSignupPage mounted",{invitationId:R,invitedEmail:Z,url:k,searchParams:Object.fromEntries(r.entries())}),()=>{w.f.info("CaregiverSignupPage unmounted")}),[R,Z,k,r]),w.f.info("URL parameters:",{rawInvitationId:S,invitationId:R,invitedEmail:Z,url:k,searchParams:Object.fromEntries(r.entries())});let z=(0,l.cI)({resolver:(0,o.F)(y),defaultValues:{name:"",email:Z?decodeURIComponent(Z):"",password:"",confirmPassword:""}});(0,a.useEffect)(()=>{!async function(){if(w.f.info("Starting invitation validation",{invitationId:R,invitedEmail:Z}),!R||!Z){w.f.warn("Missing invitation parameters",{invitationId:R,invitedEmail:Z}),C("Invalid invitation format"),I(!1);return}try{var e,r;w.f.info("Validating invitation:",{invitationId:R,invitedEmail:Z}),w.f.info("Invitation query details:",{invitationId:R,invitedEmail:Z,decodedEmail:decodeURIComponent(Z),isValidUUID:(0,w.z)(R)});let{data:t,error:i}=await j.from("caregiver_invitations").select("\n            id,\n            email,\n            name,\n            status,\n            expires_at,\n            specialists (\n              name,\n              business_name\n            )\n          ").eq("id",R).eq("email",Z).single();if(w.f.info("Query result:",{hasData:!!t,data:t,error:i}),i)throw w.f.error("Invitation query failed",{error:i,invitationId:R,status:i.code,message:i.message,details:i.details}),Error("Invitation not found");if(t.email!==decodeURIComponent(Z))throw w.f.warn("Email mismatch in invitation",{invitationEmail:t.email,providedEmail:decodeURIComponent(Z)}),Error("Invalid invitation email");w.f.info("Raw invitation data received:",t);let a={...t,specialists:Array.isArray(t.specialists)?t.specialists[0]:t.specialists};if("accepted"===a.status)throw w.f.warn("Attempt to use already accepted invitation",{invitationId:R,status:a.status}),Error("This invitation has already been used");if(a.expires_at&&new Date(a.expires_at)<new Date)throw w.f.warn("Attempt to use expired invitation",{invitationId:R,expiresAt:a.expires_at}),Error("This invitation has expired");w.f.info("Invitation is valid:",a),E((null===(e=a.specialists)||void 0===e?void 0:e.business_name)||(null===(r=a.specialists)||void 0===r?void 0:r.name)||null),a.name&&z.setValue("name",a.name),I(!1)}catch(e){w.f.error("Invitation validation failed",{error:e,invitationId:R,invitedEmail:Z}),C(e instanceof Error?e.message:"Invalid invitation"),I(!1)}}()},[R,Z,z]);let A=async r=>{if(w.f.info("Starting form submission",{email:r.email,name:r.name,invitationId:R}),!R){w.f.error("Missing invitationId during form submission"),t({variant:"destructive",title:"Error",description:"Invalid invitation"});return}g(!0);try{let{data:i,error:a}=await v.OQ.rpc("check_user_exists",{p_email:r.email});if(a)throw w.f.error("User lookup failed",{error:a}),a;if(i)throw w.f.info("User already exists"),Error("An account with this email already exists");w.f.info("Creating new auth account");let{data:n,error:s}=await v.OQ.auth.signUp({email:r.email,password:r.password,options:{data:{name:r.name,role:"caregiver"}}});if(s)throw w.f.error("Auth signup failed",{error:s}),s;if(!n.user)throw w.f.error("Auth signup returned no user"),Error("Failed to create account");w.f.info("Calling handle_caregiver_signup RPC",{userId:n.user.id,invitationId:R});let{error:o}=await v.OQ.rpc("handle_caregiver_signup",{p_user_id:n.user.id,p_invitation_id:R});if(o)throw w.f.error("RPC call failed",{error:o}),o;w.f.info("Signup process completed successfully"),t({title:"Account created",description:"Your caregiver account has been created successfully. Please check your email to verify your account."}),e.push("/login/caregiver")}catch(e){w.f.error("Signup process failed",{error:e,email:r.email,invitationId:R}),t({variant:"destructive",title:"Error",description:e instanceof Error?e.message:"Failed to create account"})}finally{g(!1)}};return b?(0,i.jsx)("div",{className:"min-h-screen bg-background flex items-center justify-center",children:(0,i.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,i.jsx)(d.Z,{className:"h-8 w-8 animate-spin text-primary"}),(0,i.jsx)("p",{className:"text-muted-foreground",children:"Validating your invitation..."})]})}):N?(0,i.jsx)("div",{className:"min-h-screen bg-background flex items-center justify-center",children:(0,i.jsx)("div",{className:"max-w-md w-full px-4",children:(0,i.jsxs)(s.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},className:"bg-card rounded-lg shadow-lg p-6 text-center",children:[(0,i.jsx)("h1",{className:"text-2xl font-bold text-destructive mb-4",children:"Invalid Invitation"}),(0,i.jsx)("p",{className:"text-muted-foreground mb-6",children:N}),(0,i.jsx)(f.z,{onClick:()=>e.push("/"),children:"Return Home"})]})})}):(0,i.jsx)("div",{className:"min-h-screen bg-background",children:(0,i.jsx)("div",{className:"max-w-md mx-auto pt-16 px-4",children:(0,i.jsxs)(s.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},className:"w-full overflow-hidden rounded-xl shadow-xl p-6 bg-card",children:[(0,i.jsxs)("div",{className:"mb-8",children:[(0,i.jsxs)(f.z,{variant:"ghost",onClick:()=>e.push("/"),className:"inline-flex items-center text-sm mb-6 text-muted-foreground hover:text-foreground",children:[(0,i.jsx)(u.Z,{className:"mr-2 h-4 w-4"}),"Back to Home"]}),(0,i.jsxs)("div",{className:"text-center",children:[(0,i.jsx)("div",{className:"inline-flex items-center justify-center w-12 h-12 rounded-full bg-primary/10 mb-4",children:(0,i.jsx)(m.Z,{className:"h-6 w-6 text-primary"})}),(0,i.jsx)("h1",{className:"text-2xl font-bold text-foreground",children:"Create Your Caregiver Account"}),_&&(0,i.jsxs)("p",{className:"mt-2 text-muted-foreground",children:["Join ",_,"'s sleep consultation practice"]})]})]}),(0,i.jsx)(p.l0,{...z,children:(0,i.jsxs)("form",{onSubmit:z.handleSubmit(A),className:"space-y-6",children:[(0,i.jsx)(p.Wi,{control:z.control,name:"name",render:e=>{let{field:r}=e;return(0,i.jsxs)(p.xJ,{children:[(0,i.jsx)(p.lX,{children:"Full Name"}),(0,i.jsx)(p.NI,{children:(0,i.jsx)(h.I,{placeholder:"Enter your name",...r})}),(0,i.jsx)(p.pf,{children:"This is how you'll appear to your sleep specialist"}),(0,i.jsx)(p.zG,{})]})}}),(0,i.jsx)(p.Wi,{control:z.control,name:"email",render:e=>{let{field:r}=e;return(0,i.jsxs)(p.xJ,{children:[(0,i.jsx)(p.lX,{children:"Email"}),(0,i.jsx)(p.NI,{children:(0,i.jsx)(h.I,{type:"email",placeholder:"Enter your email",disabled:!0,...r})}),(0,i.jsx)(p.pf,{children:"This is the email where you received the invitation"}),(0,i.jsx)(p.zG,{})]})}}),(0,i.jsx)(p.Wi,{control:z.control,name:"password",render:e=>{let{field:r}=e;return(0,i.jsxs)(p.xJ,{children:[(0,i.jsx)(p.lX,{children:"Password"}),(0,i.jsx)(p.NI,{children:(0,i.jsx)(h.I,{type:"password",placeholder:"Create a password",...r})}),(0,i.jsx)(p.pf,{children:"Must be at least 8 characters with uppercase, lowercase, and numbers"}),(0,i.jsx)(p.zG,{})]})}}),(0,i.jsx)(p.Wi,{control:z.control,name:"confirmPassword",render:e=>{let{field:r}=e;return(0,i.jsxs)(p.xJ,{children:[(0,i.jsx)(p.lX,{children:"Confirm Password"}),(0,i.jsx)(p.NI,{children:(0,i.jsx)(h.I,{type:"password",placeholder:"Confirm your password",...r})}),(0,i.jsx)(p.zG,{})]})}}),(0,i.jsx)(f.z,{type:"submit",className:"w-full",disabled:c,children:c?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(d.Z,{className:"mr-2 h-4 w-4 animate-spin"}),"Creating Account..."]}):"Create Caregiver Account"})]})})]})})})}},1315:function(e,r,t){"use strict";t.d(r,{NI:function(){return x},Wi:function(){return u},l0:function(){return c},lX:function(){return h},pf:function(){return v},xJ:function(){return p},zG:function(){return w}});var i=t(7437),a=t(2265),n=t(7256),s=t(1865),o=t(9311),l=t(6672);let c=s.RV,d=a.createContext({}),u=e=>{let{...r}=e;return(0,i.jsx)(d.Provider,{value:{name:r.name},children:(0,i.jsx)(s.Qr,{...r})})},m=()=>{let e=a.useContext(d),r=a.useContext(f),{getFieldState:t,formState:i}=(0,s.Gc)(),n=t(e.name,i);if(!e)throw Error("useFormField should be used within <FormField>");let{id:o}=r;return{id:o,name:e.name,formItemId:"".concat(o,"-form-item"),formDescriptionId:"".concat(o,"-form-item-description"),formMessageId:"".concat(o,"-form-item-message"),...n}},f=a.createContext({}),p=a.forwardRef((e,r)=>{let{className:t,...n}=e,s=a.useId();return(0,i.jsx)(f.Provider,{value:{id:s},children:(0,i.jsx)("div",{ref:r,className:(0,o.cn)("space-y-2",t),...n})})});p.displayName="FormItem";let h=a.forwardRef((e,r)=>{let{className:t,...a}=e,{error:n,formItemId:s}=m();return(0,i.jsx)(l._,{ref:r,className:(0,o.cn)(n&&"text-destructive",t),htmlFor:s,...a})});h.displayName="FormLabel";let x=a.forwardRef((e,r)=>{let{...t}=e,{error:a,formItemId:s,formDescriptionId:o,formMessageId:l}=m();return(0,i.jsx)(n.g7,{ref:r,id:s,"aria-describedby":a?"".concat(o," ").concat(l):"".concat(o),"aria-invalid":!!a,...t})});x.displayName="FormControl";let v=a.forwardRef((e,r)=>{let{className:t,...a}=e,{formDescriptionId:n}=m();return(0,i.jsx)("p",{ref:r,id:n,className:(0,o.cn)("text-sm text-muted-foreground",t),...a})});v.displayName="FormDescription";let w=a.forwardRef((e,r)=>{let{className:t,children:a,...n}=e,{error:s,formMessageId:l}=m(),c=s?String(null==s?void 0:s.message):a;return c?(0,i.jsx)("p",{ref:r,id:l,className:(0,o.cn)("text-sm font-medium text-destructive",t),...n,children:c}):null});w.displayName="FormMessage"},6672:function(e,r,t){"use strict";t.d(r,{_:function(){return c}});var i=t(7437),a=t(2265),n=t(6743),s=t(6061),o=t(9311);let l=(0,s.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),c=a.forwardRef((e,r)=>{let{className:t,...a}=e;return(0,i.jsx)(n.f,{ref:r,className:(0,o.cn)(l(),t),...a})});c.displayName=n.f.displayName},9381:function(e,r,t){"use strict";t.d(r,{WV:function(){return o},jH:function(){return l}});var i=t(2265),a=t(4887),n=t(7256),s=t(7437),o=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"].reduce((e,r)=>{let t=i.forwardRef((e,t)=>{let{asChild:i,...a}=e,o=i?n.g7:r;return"undefined"!=typeof window&&(window[Symbol.for("radix-ui")]=!0),(0,s.jsx)(o,{...a,ref:t})});return t.displayName=`Primitive.${r}`,{...e,[r]:t}},{});function l(e,r){e&&a.flushSync(()=>e.dispatchEvent(r))}}},function(e){e.O(0,[579,892,233,834,971,864,744],function(){return e(e.s=3206)}),_N_E=e.O()}]);