(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[883],{7858:function(e,r,t){Promise.resolve().then(t.bind(t,3713))},3713:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return s}});var n=t(2265),o=t(4033),i=t(4863);function s(){let e=(0,o.useRouter)(),{role:r}=(0,i.a)();return(0,n.useEffect)(()=>{"caregiver"===r?e.replace("/dashboard/caregiver"):"specialist"===r&&e.replace("/dashboard/specialist")},[r,e]),null}},4863:function(e,r,t){"use strict";t.d(r,{a:function(){return a}});var n=t(2265),o=t(4660),i=t(6763),s=t(9311);let u=(0,o.Ue)(e=>({user:null,session:null,role:null,loading:!1,error:null,signIn:async(r,t,n)=>{try{var o,u;e({loading:!0,error:null}),s.f.info("Starting sign in process",{email:r,role:n});let{data:a,error:l}=await i.OQ.rpc("check_user_exists",{p_email:r});if(l)throw l;if(!a)throw Error("No account found with this email");let{data:c,error:f}=await i.OQ.auth.signInWithPassword({email:r,password:t});if(f)throw f;let d=(null===(u=c.user)||void 0===u?void 0:null===(o=u.user_metadata)||void 0===o?void 0:o.role)||n;if(s.f.info("Sign in successful",{userId:c.user.id,role:d}),"specialist"===d||"caregiver"===d){let{error:e}=await i.OQ.rpc("ensure_specialist_record_exists",{p_user_id:c.user.id});if(e)throw e;s.f.info("Profile record ensured",{role:d})}let h=3;for(;h>0;)try{break}catch(e){throw s.f.warn("Profile check failed, retrying...",{retries:h}),await new Promise(e=>setTimeout(e,1e3)),h--,e}e({user:c.user,session:c.session,role:d,loading:!1,error:null})}catch(r){throw s.f.error("Sign in failed",r),e({error:r instanceof Error?r.message:"An unknown error occurred",loading:!1,user:null,session:null,role:null}),r}},refreshAuth:async()=>{try{let n=await (0,i.dx)();if(n){var r,t;let o=null===(t=n.user)||void 0===t?void 0:null===(r=t.user_metadata)||void 0===r?void 0:r.role;e({user:n.user,session:n,role:o,loading:!1,error:null})}}catch(r){e({error:"Failed to refresh session",loading:!1})}},signOut:async()=>{try{s.f.info("Starting sign out"),e({loading:!0,error:null}),await i.OQ.auth.signOut(),e({user:null,session:null,role:null,loading:!1,error:null})}catch(r){throw s.f.error("Sign out failed",r),e({error:"Failed to sign out",loading:!1}),r}},clearError:()=>e({error:null})}));function a(){let{user:e,session:r,role:t,loading:o,error:s,signOut:a,clearError:l,refreshAuth:c}=u();(0,n.useEffect)(()=>{i.OQ.auth.getSession().then(e=>{var r,t,n;let{data:{session:o}}=e,i=null==o?void 0:null===(t=o.user)||void 0===t?void 0:null===(r=t.user_metadata)||void 0===r?void 0:r.role;u.setState({user:null!==(n=null==o?void 0:o.user)&&void 0!==n?n:null,session:o,role:i,loading:!1})});let{data:{subscription:e}}=i.OQ.auth.onAuthStateChange((e,r)=>{var t,n,o;let i=null==r?void 0:null===(n=r.user)||void 0===n?void 0:null===(t=n.user_metadata)||void 0===t?void 0:t.role;u.setState({user:null!==(o=null==r?void 0:r.user)&&void 0!==o?o:null,session:r,role:i,loading:!1,error:null})});return()=>e.unsubscribe()},[]),(0,n.useEffect)(()=>{if(!r)return;let e=async()=>{let e=await (0,i.z6)();e||await c()},t=setInterval(e,6e4);return()=>clearInterval(t)},[r,c]);let f=async(e,r,t)=>{try{var n,o;u.setState({loading:!0,error:null});let{data:s,error:a}=await i.OQ.rpc("check_user_exists",{p_email:e});if(a)throw a;if(!s)throw Error("No account found with this email");let{data:l,error:c}=await i.OQ.auth.signInWithPassword({email:e,password:r});if(c)throw c;let f=(null===(o=l.user)||void 0===o?void 0:null===(n=o.user_metadata)||void 0===n?void 0:n.role)||t;if("specialist"===f||"caregiver"===f){let{error:e}=await i.OQ.rpc("specialist"===f?"ensure_specialist_record_exists":"ensure_caregiver_exists",{p_user_id:l.user.id});if(e)throw e}let d=3;for(;d>0;)try{let{data:e}=await i.OQ.from("specialist"===f?"specialists":"caregivers").select("id").eq("auth_user_id",l.user.id).single();if(e)break;await new Promise(e=>setTimeout(e,1e3)),d--}catch(e){if(console.error("Profile check failed, retrying...",e),d--,0===d)throw e}u.setState({user:l.user,session:l.session,role:f,loading:!1,error:null})}catch(e){throw u.setState({error:e instanceof Error?e.message:"An unknown error occurred",loading:!1,user:null,session:null,role:null}),e}};return{user:e,session:r,loading:o,role:t,error:s,signIn:f,signOut:a,clearError:l,refreshAuth:c}}},6763:function(e,r,t){"use strict";t.d(r,{OQ:function(){return o},dx:function(){return s},z6:function(){return i}});var n=t(4566);let o=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=(0,n.eI)("https://xuqkgeusasosxtcfhbwj.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inh1cWtnZXVzYXNvc3h0Y2ZoYndqIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTczNjMwODU5NSwiZXhwIjoyMDUxODg0NTk1fQ.mDgADwthCJGMesU6F6-ui9XfLw7DGoA06k66mGEAGKU",{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,storage:{getItem:e=>{try{let r=window.localStorage.getItem(e);return r}catch(e){return console.error("Error reading session:",e),null}},setItem:(e,r)=>{try{window.localStorage.setItem(e,r)}catch(e){console.error("Error storing session:",e)}},removeItem:e=>{try{window.localStorage.removeItem(e)}catch(e){console.error("Error removing session:",e)}}}},db:{schema:"public"},global:{fetch:async function(){for(var r=arguments.length,t=Array(r),n=0;n<r;n++)t[n]=arguments[n];try{let e=await fetch(...t);return e}catch(r){if(e<3)return await new Promise(e=>setTimeout(e,1e3)),fetch(...t);throw r}}}});return r}(),i=async()=>{try{let{data:{session:e},error:r}=await o.auth.getSession();if(r)throw r;if(null==e?void 0:e.expires_at){let r=new Date(1e3*e.expires_at),t=new Date;return r>t}return!1}catch(e){return console.error("Error checking session:",e),!1}},s=async()=>{try{let{data:{session:e},error:r}=await o.auth.getSession();if(r)throw r;if(e){let r=new Date(1e3*e.expires_at),t=new Date;if(r.getTime()-t.getTime()<3e5){let{data:{session:e},error:r}=await o.auth.refreshSession();if(r)throw r;return e}return e}return null}catch(e){return console.error("Error refreshing session:",e),null}}},9311:function(e,r,t){"use strict";t.d(r,{cn:function(){return i},f:function(){return u},z:function(){return s}});var n=t(7042),o=t(4769);function i(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return(0,o.m6)((0,n.W)(r))}function s(e){return/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}let u={info:function(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return console.log("[INFO]",...r)},error:function(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return console.error("[ERROR]",...r)},warn:function(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return console.warn("[WARN]",...r)}}},4033:function(e,r,t){e.exports=t(290)},9808:function(e,r,t){"use strict";/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var n=t(2265),o="function"==typeof Object.is?Object.is:function(e,r){return e===r&&(0!==e||1/e==1/r)||e!=e&&r!=r},i=n.useState,s=n.useEffect,u=n.useLayoutEffect,a=n.useDebugValue;function l(e){var r=e.getSnapshot;e=e.value;try{var t=r();return!o(e,t)}catch(e){return!0}}var c="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(e,r){return r()}:function(e,r){var t=r(),n=i({inst:{value:t,getSnapshot:r}}),o=n[0].inst,c=n[1];return u(function(){o.value=t,o.getSnapshot=r,l(o)&&c({inst:o})},[e,t,r]),s(function(){return l(o)&&c({inst:o}),e(function(){l(o)&&c({inst:o})})},[e]),a(t),t};r.useSyncExternalStore=void 0!==n.useSyncExternalStore?n.useSyncExternalStore:c},3176:function(e,r,t){"use strict";/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var n=t(2265),o=t(6272),i="function"==typeof Object.is?Object.is:function(e,r){return e===r&&(0!==e||1/e==1/r)||e!=e&&r!=r},s=o.useSyncExternalStore,u=n.useRef,a=n.useEffect,l=n.useMemo,c=n.useDebugValue;r.useSyncExternalStoreWithSelector=function(e,r,t,n,o){var f=u(null);if(null===f.current){var d={hasValue:!1,value:null};f.current=d}else d=f.current;var h=s(e,(f=l(function(){function e(e){if(!a){if(a=!0,s=e,e=n(e),void 0!==o&&d.hasValue){var r=d.value;if(o(r,e))return u=r}return u=e}if(r=u,i(s,e))return r;var t=n(e);return void 0!==o&&o(r,t)?(s=e,r):(s=e,u=t)}var s,u,a=!1,l=void 0===t?null:t;return[function(){return e(r())},null===l?void 0:function(){return e(l())}]},[r,t,n,o]))[0],f[1]);return a(function(){d.hasValue=!0,d.value=h},[h]),c(h),h}},6272:function(e,r,t){"use strict";e.exports=t(9808)},5401:function(e,r,t){"use strict";e.exports=t(3176)},4660:function(e,r,t){"use strict";t.d(r,{Ue:function(){return d}});let n=e=>{let r;let t=new Set,n=(e,n)=>{let o="function"==typeof e?e(r):e;if(!Object.is(o,r)){let e=r;r=(null!=n?n:"object"!=typeof o||null===o)?o:Object.assign({},r,o),t.forEach(t=>t(r,e))}},o=()=>r,i={setState:n,getState:o,getInitialState:()=>s,subscribe:e=>(t.add(e),()=>t.delete(e)),destroy:()=>{console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),t.clear()}},s=r=e(n,o,i);return i},o=e=>e?n(e):n;var i=t(2265),s=t(5401);let{useDebugValue:u}=i,{useSyncExternalStoreWithSelector:a}=s,l=!1,c=e=>e,f=e=>{"function"!=typeof e&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");let r="function"==typeof e?o(e):e,t=(e,t)=>(function(e,r=c,t){t&&!l&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),l=!0);let n=a(e.subscribe,e.getState,e.getServerState||e.getInitialState,r,t);return u(n),n})(r,e,t);return Object.assign(t,r),t},d=e=>e?f(e):f}},function(e){e.O(0,[985,566,971,864,744],function(){return e(e.s=7858)}),_N_E=e.O()}]);