(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[883],{7122:function(e,t,r){Promise.resolve().then(r.bind(r,3713))},3713:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return u}});var n=r(2265),i=r(4033),o=r(4863);function u(){let e=(0,i.useRouter)(),{role:t}=(0,o.a)();return(0,n.useEffect)(()=>{"caregiver"===t?e.replace("/dashboard/caregiver"):"specialist"===t&&e.replace("/dashboard/specialist")},[t,e]),null}},4863:function(e,t,r){"use strict";r.d(t,{a:function(){return s}});var n=r(2265),i=r(4660),o=r(6763);let u=(0,i.Ue)(e=>({user:null,session:null,role:null,loading:!1,error:null,signIn:async(t,r,n)=>{try{var i,u;e({loading:!0,error:null});let{data:s,error:a}=await o.OQ.rpc("check_user_exists",{p_email:t});if(a)throw a;if(!s)throw Error("No account found with this email");let{data:l,error:c}=await o.OQ.auth.signInWithPassword({email:t,password:r});if(c)throw c;let d=(null===(u=l.user)||void 0===u?void 0:null===(i=u.user_metadata)||void 0===i?void 0:i.role)||n;if("specialist"===d){let{error:e}=await o.OQ.rpc("ensure_specialist_record_exists",{p_user_id:l.user.id});if(e)throw e}e({user:l.user,session:l.session,role:d,loading:!1,error:null})}catch(t){throw e({error:t instanceof Error?t.message:"An unknown error occurred",loading:!1,user:null,session:null,role:null}),t}},refreshAuth:async()=>{try{let n=await (0,o.dx)();if(n){var t,r;let i=null===(r=n.user)||void 0===r?void 0:null===(t=r.user_metadata)||void 0===t?void 0:t.role;e({user:n.user,session:n,role:i,loading:!1,error:null})}}catch(t){e({error:"Failed to refresh session",loading:!1})}},signOut:async()=>{try{e({loading:!0,error:null}),await o.OQ.auth.signOut(),e({user:null,session:null,role:null,loading:!1,error:null})}catch(t){throw e({error:"Failed to sign out",loading:!1}),t}},clearError:()=>e({error:null})}));function s(){let{user:e,session:t,role:r,loading:i,error:s,signOut:a,clearError:l,refreshAuth:c}=u();(0,n.useEffect)(()=>{o.OQ.auth.getSession().then(e=>{var t,r,n;let{data:{session:i}}=e,o=null==i?void 0:null===(r=i.user)||void 0===r?void 0:null===(t=r.user_metadata)||void 0===t?void 0:t.role;u.setState({user:null!==(n=null==i?void 0:i.user)&&void 0!==n?n:null,session:i,role:o,loading:!1})});let{data:{subscription:e}}=o.OQ.auth.onAuthStateChange((e,t)=>{var r,n,i;let o=null==t?void 0:null===(n=t.user)||void 0===n?void 0:null===(r=n.user_metadata)||void 0===r?void 0:r.role;u.setState({user:null!==(i=null==t?void 0:t.user)&&void 0!==i?i:null,session:t,role:o,loading:!1,error:null})});return()=>e.unsubscribe()},[]),(0,n.useEffect)(()=>{if(!t)return;let e=async()=>{let e=await (0,o.z6)();e||await c()},r=setInterval(e,6e4);return()=>clearInterval(r)},[t,c]);let d=async(e,t,r)=>{let{data:n,error:i}=await o.OQ.auth.signInWithPassword({email:e,password:t});if(i)throw i;if(r){let{data:e,error:t}=await o.OQ.from("caregiver"===r?"caregivers":"specialists").select("id").eq("auth_user_id",n.user.id).single();if(t||!e)throw await o.OQ.auth.signOut(),Error("Invalid ".concat(r," account"))}return n};return{user:e,session:t,loading:i,role:r,error:s,signIn:d,signOut:a,clearError:l,refreshAuth:c}}},6763:function(e,t,r){"use strict";r.d(t,{OQ:function(){return i},dx:function(){return u},z6:function(){return o}});var n=r(4566);let i=(0,n.eI)("https://xuqkgeusasosxtcfhbwj.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inh1cWtnZXVzYXNvc3h0Y2ZoYndqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzYzMDg1OTUsImV4cCI6MjA1MTg4NDU5NX0.HF4gYNKUEct3xetUJ3NwB1pxgBGBSE2V6CY20iF1Ivs",{auth:{autoRefreshToken:!0,persistSession:!0,storage:{getItem:e=>{try{let t=window.localStorage.getItem(e);return t}catch(e){return console.error("Error reading session:",e),null}},setItem:(e,t)=>{try{window.localStorage.setItem(e,t)}catch(e){console.error("Error storing session:",e)}},removeItem:e=>{try{window.localStorage.removeItem(e)}catch(e){console.error("Error removing session:",e)}}}},db:{schema:"public"}}),o=async()=>{try{let{data:{session:e},error:t}=await i.auth.getSession();if(t)throw t;if(null==e?void 0:e.expires_at){let t=new Date(1e3*e.expires_at),r=new Date;return t>r}return!1}catch(e){return console.error("Error checking session:",e),!1}},u=async()=>{try{let{data:{session:e},error:t}=await i.auth.getSession();if(t)throw t;if(e){let t=new Date(1e3*e.expires_at),r=new Date;if(t.getTime()-r.getTime()<3e5){let{data:{session:e},error:t}=await i.auth.refreshSession();if(t)throw t;return e}return e}return null}catch(e){return console.error("Error refreshing session:",e),null}}},4033:function(e,t,r){e.exports=r(290)},9808:function(e,t,r){"use strict";/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var n=r(2265),i="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},o=n.useState,u=n.useEffect,s=n.useLayoutEffect,a=n.useDebugValue;function l(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!i(e,r)}catch(e){return!0}}var c="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(e,t){return t()}:function(e,t){var r=t(),n=o({inst:{value:r,getSnapshot:t}}),i=n[0].inst,c=n[1];return s(function(){i.value=r,i.getSnapshot=t,l(i)&&c({inst:i})},[e,r,t]),u(function(){return l(i)&&c({inst:i}),e(function(){l(i)&&c({inst:i})})},[e]),a(r),r};t.useSyncExternalStore=void 0!==n.useSyncExternalStore?n.useSyncExternalStore:c},3176:function(e,t,r){"use strict";/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var n=r(2265),i=r(6272),o="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},u=i.useSyncExternalStore,s=n.useRef,a=n.useEffect,l=n.useMemo,c=n.useDebugValue;t.useSyncExternalStoreWithSelector=function(e,t,r,n,i){var d=s(null);if(null===d.current){var f={hasValue:!1,value:null};d.current=f}else f=d.current;var h=u(e,(d=l(function(){function e(e){if(!a){if(a=!0,u=e,e=n(e),void 0!==i&&f.hasValue){var t=f.value;if(i(t,e))return s=t}return s=e}if(t=s,o(u,e))return t;var r=n(e);return void 0!==i&&i(t,r)?(u=e,t):(u=e,s=r)}var u,s,a=!1,l=void 0===r?null:r;return[function(){return e(t())},null===l?void 0:function(){return e(l())}]},[t,r,n,i]))[0],d[1]);return a(function(){f.hasValue=!0,f.value=h},[h]),c(h),h}},6272:function(e,t,r){"use strict";e.exports=r(9808)},5401:function(e,t,r){"use strict";e.exports=r(3176)},4660:function(e,t,r){"use strict";r.d(t,{Ue:function(){return f}});let n=e=>{let t;let r=new Set,n=(e,n)=>{let i="function"==typeof e?e(t):e;if(!Object.is(i,t)){let e=t;t=(null!=n?n:"object"!=typeof i||null===i)?i:Object.assign({},t,i),r.forEach(r=>r(t,e))}},i=()=>t,o={setState:n,getState:i,getInitialState:()=>u,subscribe:e=>(r.add(e),()=>r.delete(e)),destroy:()=>{console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),r.clear()}},u=t=e(n,i,o);return o},i=e=>e?n(e):n;var o=r(2265),u=r(5401);let{useDebugValue:s}=o,{useSyncExternalStoreWithSelector:a}=u,l=!1,c=e=>e,d=e=>{"function"!=typeof e&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");let t="function"==typeof e?i(e):e,r=(e,r)=>(function(e,t=c,r){r&&!l&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),l=!0);let n=a(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,r);return s(n),n})(t,e,r);return Object.assign(r,t),r},f=e=>e?d(e):d}},function(e){e.O(0,[566,971,864,744],function(){return e(e.s=7122)}),_N_E=e.O()}]);