(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[663],{5395:function(e,r,t){Promise.resolve().then(t.bind(t,7226))},7226:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return v}});var s=t(7437),n=t(2265),i=t(4033),a=t(4863),o=t(7346),l=t(5750),u=t(9409),c=t(3088),d=t(4135),f=t(5883),h=t(1350),g=t(3023);function v(e){let{children:r}=e,t=(0,i.useRouter)(),v=(0,i.usePathname)(),{user:m,role:w,signOut:x}=(0,a.a)(),{theme:p,setTheme:y}=(0,h.F)(),b=(0,n.useMemo)(()=>"caregiver"===w?"/dashboard/caregiver":"/dashboard/specialist",[w]);if((0,n.useEffect)(()=>{if(!m){let e="caregiver"===w?"/login/caregiver":"/login/specialist";t.replace(e);return}"/dashboard"===v&&t.replace(b)},[m,w,t,v,b]),!m)return null;let N=async()=>{await x(),t.replace("/")};return(0,s.jsxs)("div",{className:"min-h-screen bg-background flex",children:[(0,s.jsxs)("div",{className:"w-64 bg-card border-r flex flex-col",children:[(0,s.jsxs)("div",{className:"p-4 border-b",children:[(0,s.jsx)("div",{className:"font-medium text-lg text-foreground",children:m.email}),(0,s.jsx)("div",{className:"text-sm text-muted-foreground",children:"caregiver"===w?"Caregiver":"Specialist"}),(0,s.jsxs)("div",{className:"text-xs text-muted-foreground",children:["Last login: ",new Date().toLocaleDateString()]})]}),(0,s.jsx)("nav",{className:"flex-1 p-4",children:(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsxs)(g.z,{variant:v===b?"secondary":"ghost",className:"w-full justify-start",onClick:()=>t.push(b),children:[(0,s.jsx)(o.Z,{className:"mr-2 h-4 w-4"}),"Home"]}),"specialist"===w?(0,s.jsxs)(g.z,{variant:"/dashboard/clients"===v?"secondary":"ghost",className:"w-full justify-start",onClick:()=>t.push("/dashboard/clients"),children:[(0,s.jsx)(l.Z,{className:"mr-2 h-4 w-4"}),"Clients"]}):(0,s.jsxs)(g.z,{variant:"/dashboard/caregivers"===v?"secondary":"ghost",className:"w-full justify-start",onClick:()=>t.push("/dashboard/caregivers"),children:[(0,s.jsx)(l.Z,{className:"mr-2 h-4 w-4"}),"Specialists"]}),(0,s.jsxs)(g.z,{variant:"/dashboard/settings"===v?"secondary":"ghost",className:"w-full justify-start",onClick:()=>t.push("/dashboard/settings"),children:[(0,s.jsx)(u.Z,{className:"mr-2 h-4 w-4"}),"Settings"]})]})}),(0,s.jsxs)("div",{className:"p-4 border-t space-y-4",children:[(0,s.jsxs)(g.z,{variant:"ghost",size:"sm",className:"w-full justify-start",onClick:()=>y("light"===p?"dark":"light"),children:["light"===p?(0,s.jsx)(c.Z,{className:"mr-2 h-4 w-4"}):(0,s.jsx)(d.Z,{className:"mr-2 h-4 w-4"}),"Switch to ","light"===p?"Dark":"Light"," Mode"]}),(0,s.jsxs)(g.z,{variant:"ghost",size:"sm",className:"w-full justify-start text-destructive hover:text-destructive",onClick:N,children:[(0,s.jsx)(f.Z,{className:"mr-2 h-4 w-4"}),"Sign Out"]})]})]}),(0,s.jsx)("div",{className:"flex-1 flex flex-col",children:r})]})}},3023:function(e,r,t){"use strict";t.d(r,{d:function(){return l},z:function(){return u}});var s=t(7437),n=t(2265),i=t(7256),a=t(6061),o=t(9311);let l=(0,a.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),u=n.forwardRef((e,r)=>{let{className:t,variant:n,size:a,asChild:u=!1,...c}=e,d=u?i.g7:"button";return(0,s.jsx)(d,{className:(0,o.cn)(l({variant:n,size:a,className:t})),ref:r,...c})});u.displayName="Button"},4863:function(e,r,t){"use strict";t.d(r,{a:function(){return l}});var s=t(2265),n=t(4660),i=t(6763),a=t(9311);let o=(0,n.Ue)(e=>({user:null,session:null,role:null,loading:!1,error:null,signIn:async(r,t,s)=>{try{var n,o;e({loading:!0,error:null}),a.f.info("Starting sign in process",{email:r,role:s});let{data:l,error:u}=await i.OQ.rpc("check_user_exists",{p_email:r});if(u)throw u;if(!l)throw Error("No account found with this email");let{data:c,error:d}=await i.OQ.auth.signInWithPassword({email:r,password:t});if(d)throw d;let f=(null===(o=c.user)||void 0===o?void 0:null===(n=o.user_metadata)||void 0===n?void 0:n.role)||s;if(a.f.info("Sign in successful",{userId:c.user.id,role:f}),"specialist"===f||"caregiver"===f){let{error:e}=await i.OQ.rpc("ensure_specialist_record_exists",{p_user_id:c.user.id});if(e)throw e;a.f.info("Profile record ensured",{role:f})}let h=3;for(;h>0;)try{break}catch(e){throw a.f.warn("Profile check failed, retrying...",{retries:h}),await new Promise(e=>setTimeout(e,1e3)),h--,e}e({user:c.user,session:c.session,role:f,loading:!1,error:null})}catch(r){throw a.f.error("Sign in failed",r),e({error:r instanceof Error?r.message:"An unknown error occurred",loading:!1,user:null,session:null,role:null}),r}},refreshAuth:async()=>{try{let s=await (0,i.dx)();if(s){var r,t;let n=null===(t=s.user)||void 0===t?void 0:null===(r=t.user_metadata)||void 0===r?void 0:r.role;e({user:s.user,session:s,role:n,loading:!1,error:null})}}catch(r){e({error:"Failed to refresh session",loading:!1})}},signOut:async()=>{try{a.f.info("Starting sign out"),e({loading:!0,error:null}),await i.OQ.auth.signOut(),e({user:null,session:null,role:null,loading:!1,error:null})}catch(r){throw a.f.error("Sign out failed",r),e({error:"Failed to sign out",loading:!1}),r}},clearError:()=>e({error:null})}));function l(){let{user:e,session:r,role:t,loading:n,error:a,signOut:l,clearError:u,refreshAuth:c}=o();(0,s.useEffect)(()=>{i.OQ.auth.getSession().then(e=>{var r,t,s;let{data:{session:n}}=e,i=null==n?void 0:null===(t=n.user)||void 0===t?void 0:null===(r=t.user_metadata)||void 0===r?void 0:r.role;o.setState({user:null!==(s=null==n?void 0:n.user)&&void 0!==s?s:null,session:n,role:i,loading:!1})});let{data:{subscription:e}}=i.OQ.auth.onAuthStateChange((e,r)=>{var t,s,n;let i=null==r?void 0:null===(s=r.user)||void 0===s?void 0:null===(t=s.user_metadata)||void 0===t?void 0:t.role;o.setState({user:null!==(n=null==r?void 0:r.user)&&void 0!==n?n:null,session:r,role:i,loading:!1,error:null})});return()=>e.unsubscribe()},[]),(0,s.useEffect)(()=>{if(!r)return;let e=async()=>{let e=await (0,i.z6)();e||await c()},t=setInterval(e,6e4);return()=>clearInterval(t)},[r,c]);let d=async(e,r,t)=>{try{var s,n;o.setState({loading:!0,error:null});let{data:a,error:l}=await i.OQ.rpc("check_user_exists",{p_email:e});if(l)throw l;if(!a)throw Error("No account found with this email");let{data:u,error:c}=await i.OQ.auth.signInWithPassword({email:e,password:r});if(c)throw c;let d=(null===(n=u.user)||void 0===n?void 0:null===(s=n.user_metadata)||void 0===s?void 0:s.role)||t;if("specialist"===d||"caregiver"===d){let{error:e}=await i.OQ.rpc("specialist"===d?"ensure_specialist_record_exists":"ensure_caregiver_exists",{p_user_id:u.user.id});if(e)throw e}let f=3;for(;f>0;)try{let{data:e}=await i.OQ.from("specialist"===d?"specialists":"caregivers").select("id").eq("auth_user_id",u.user.id).single();if(e)break;await new Promise(e=>setTimeout(e,1e3)),f--}catch(e){if(console.error("Profile check failed, retrying...",e),f--,0===f)throw e}o.setState({user:u.user,session:u.session,role:d,loading:!1,error:null})}catch(e){throw o.setState({error:e instanceof Error?e.message:"An unknown error occurred",loading:!1,user:null,session:null,role:null}),e}};return{user:e,session:r,loading:n,role:t,error:a,signIn:d,signOut:l,clearError:u,refreshAuth:c}}},6763:function(e,r,t){"use strict";t.d(r,{OQ:function(){return n},dx:function(){return a},z6:function(){return i}});var s=t(4566);let n=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=(0,s.eI)("https://xuqkgeusasosxtcfhbwj.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inh1cWtnZXVzYXNvc3h0Y2ZoYndqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzYzMDg1OTUsImV4cCI6MjA1MTg4NDU5NX0.HF4gYNKUEct3xetUJ3NwB1pxgBGBSE2V6CY20iF1Ivs",{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,storage:{getItem:e=>{try{let r=window.localStorage.getItem(e);return r}catch(e){return console.error("Error reading session:",e),null}},setItem:(e,r)=>{try{window.localStorage.setItem(e,r)}catch(e){console.error("Error storing session:",e)}},removeItem:e=>{try{window.localStorage.removeItem(e)}catch(e){console.error("Error removing session:",e)}}}},db:{schema:"public"},global:{fetch:async function(){for(var r=arguments.length,t=Array(r),s=0;s<r;s++)t[s]=arguments[s];try{let e=await fetch(...t);return e}catch(r){if(e<3)return await new Promise(e=>setTimeout(e,1e3)),fetch(...t);throw r}}}});return r}(),i=async()=>{try{let{data:{session:e},error:r}=await n.auth.getSession();if(r)throw r;if(null==e?void 0:e.expires_at){let r=new Date(1e3*e.expires_at),t=new Date;return r>t}return!1}catch(e){return console.error("Error checking session:",e),!1}},a=async()=>{try{let{data:{session:e},error:r}=await n.auth.getSession();if(r)throw r;if(e){let r=new Date(1e3*e.expires_at),t=new Date;if(r.getTime()-t.getTime()<3e5){let{data:{session:e},error:r}=await n.auth.refreshSession();if(r)throw r;return e}return e}return null}catch(e){return console.error("Error refreshing session:",e),null}}},9311:function(e,r,t){"use strict";t.d(r,{cn:function(){return i},f:function(){return o},z:function(){return a}});var s=t(7042),n=t(4769);function i(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return(0,n.m6)((0,s.W)(r))}function a(e){return/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}let o={info:function(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return console.log("[INFO]",...r)},error:function(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return console.error("[ERROR]",...r)},warn:function(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return console.warn("[WARN]",...r)}}}},function(e){e.O(0,[579,116,971,864,744],function(){return e(e.s=5395)}),_N_E=e.O()}]);