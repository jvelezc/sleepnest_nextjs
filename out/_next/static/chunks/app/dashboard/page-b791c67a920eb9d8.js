(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[702],{5750:function(e,s,t){"use strict";t.d(s,{Z:function(){return r}});var a=t(5531);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,a.Z)("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]])},8714:function(e,s,t){Promise.resolve().then(t.bind(t,9345))},9345:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return j}});var a=t(7437),r=t(2265),l=t(4033),i=t(5750),d=t(5531);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let c=(0,d.Z)("ChartLine",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"m19 9-5 5-4-4-3 3",key:"2osh9i"}]]),n=(0,d.Z)("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);var o=t(2176),m=t(9314),x=t(6042),u=t(4863),h=t(6763),f=t(6110),p=t(3023),g=t(9401);function j(){let e=(0,l.useRouter)(),{user:s}=(0,u.a)(),[t,d]=(0,r.useState)([]),[j,v]=(0,r.useState)(!0),[N,y]=(0,r.useState)(null),[b,_]=(0,r.useState)(null),[w,k]=(0,r.useState)(null);return((0,r.useEffect)(()=>{(async function(){if(!s){v(!1);return}try{y(null);let{data:e,error:t}=await h.OQ.from("specialists").select("id").eq("auth_user_id",s.id).single();if(t)throw t;e&&_(e.id)}catch(e){console.error("Error fetching specialist ID:",e),y("Failed to fetch specialist data")}finally{v(!1)}})()},[s]),(0,r.useEffect)(()=>{(async function(){if(b)try{v(!0),y(null);let{data:e,error:s}=await h.OQ.rpc("get_specialist_caregivers",{p_specialist_id:b,p_sort_field:"last_activity",p_sort_order:"desc",p_limit:9,p_offset:0});if(s)throw s;d(e||[])}catch(e){console.error("Error loading caregivers:",e),y("Failed to load caregivers")}finally{v(!1)}})()},[b]),j)?(0,a.jsxs)("div",{className:"flex-1 p-8",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-8",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-foreground",children:"Sleep Specialist Dashboard"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Manage your clients and track their progress"})]}),(0,a.jsx)(x.W,{})]}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-foreground",children:"Your Caregivers"}),(0,a.jsx)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:[void 0,void 0,void 0].map((e,s)=>(0,a.jsxs)(f.Zb,{className:"animate-pulse",children:[(0,a.jsxs)(f.Ol,{className:"space-y-4",children:[(0,a.jsx)("div",{className:"h-4 bg-muted rounded w-3/4"}),(0,a.jsx)("div",{className:"h-3 bg-muted rounded w-1/2"})]}),(0,a.jsx)(f.aY,{children:(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("div",{className:"h-3 bg-muted rounded"}),(0,a.jsx)("div",{className:"h-3 bg-muted rounded w-5/6"})]})})]},s))})]})]}):0===t.length?(0,a.jsxs)("div",{className:"flex-1 p-8",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-8",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-foreground",children:"Sleep Specialist Dashboard"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Manage your clients and track their progress"})]}),(0,a.jsx)(x.W,{})]}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-foreground",children:"Your Caregivers"}),(0,a.jsx)("div",{className:"rounded-lg border bg-card p-8",children:(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center text-center",children:[(0,a.jsx)("div",{className:"h-12 w-12 rounded-full bg-primary/10 flex items-center justify-center mb-4",children:(0,a.jsx)(i.Z,{className:"h-6 w-6 text-primary"})}),(0,a.jsx)("h3",{className:"text-lg font-medium text-foreground",children:"Welcome to Your Dashboard"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground mt-2 max-w-sm",children:"You haven't added any caregivers yet. Start growing your practice by inviting your first caregiver."}),(0,a.jsx)(x.W,{})]})})]})]}):(0,a.jsxs)("div",{className:"flex-1 p-8",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-8",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-foreground",children:"Sleep Specialist Dashboard"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Welcome back! Here's an overview of your practice"})]}),(0,a.jsx)(x.W,{})]}),(0,a.jsxs)("div",{className:"grid gap-4 md:grid-cols-3 mb-8",children:[(0,a.jsxs)(f.Zb,{children:[(0,a.jsxs)(f.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(f.ll,{className:"text-sm font-medium",children:"Total Clients"}),(0,a.jsx)(i.Z,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsxs)(f.aY,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold",children:t.length}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Active clients in your practice"})]})]}),(0,a.jsxs)(f.Zb,{children:[(0,a.jsxs)(f.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(f.ll,{className:"text-sm font-medium",children:"Recent Activity"}),(0,a.jsx)(c,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsxs)(f.aY,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold",children:t.filter(e=>{let s=new Date(e.last_activity),t=new Date;return t.getTime()-s.getTime()<864e5}).length}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Clients active in last 24h"})]})]}),(0,a.jsxs)(f.Zb,{children:[(0,a.jsxs)(f.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(f.ll,{className:"text-sm font-medium",children:"New Clients"}),(0,a.jsx)(n,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsxs)(f.aY,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold",children:t.filter(e=>{let s=new Date(e.last_activity),t=new Date;return t.getTime()-s.getTime()<6048e5}).length}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"New clients this week"})]})]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-foreground",children:"Recent Activity"}),(0,a.jsx)(p.z,{variant:"outline",onClick:()=>e.push("/dashboard/clients"),children:"View All Clients"})]}),(0,a.jsx)(f.Zb,{children:(0,a.jsx)(f.aY,{className:"p-0",children:(0,a.jsx)("div",{className:"divide-y",children:t.sort((e,s)=>new Date(s.last_activity).getTime()-new Date(e.last_activity).getTime()).slice(0,5).map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-4",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("p",{className:"text-sm font-medium leading-none",children:e.caregiver_name}),(0,a.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Last active ",(0,m.ZP)(new Date(e.last_activity),"MMM d, h:mm a")]})]}),(0,a.jsxs)(p.z,{variant:"ghost",size:"sm",className:"flex items-center gap-2",onClick:()=>{b&&k({specialistId:b,caregiverId:e.caregiver_id,caregiverName:e.caregiver_name})},children:[(0,a.jsx)(o.Z,{className:"h-4 w-4"}),"Chat"]})]},e.caregiver_id))})})})]}),w&&(0,a.jsx)(g.z,{specialistId:w.specialistId,caregiverId:w.caregiverId,caregiverName:w.caregiverName,onClose:()=>k(null)})]})}},9401:function(e,s,t){"use strict";t.d(s,{z:function(){return y}});var a=t(7437),r=t(2549),l=t(6020),i=t(2265),d=t(9314),c=t(3023),n=t(6110),o=t(1908),m=t(6694),x=t(9311);let u=i.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(m.fC,{ref:s,className:(0,x.cn)("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",t),...r})});u.displayName=m.fC.displayName;let h=i.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(m.Ee,{ref:s,className:(0,x.cn)("aspect-square h-full w-full",t),...r})});h.displayName=m.Ee.displayName;let f=i.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(m.NY,{ref:s,className:(0,x.cn)("flex h-full w-full items-center justify-center rounded-full bg-muted",t),...r})});f.displayName=m.NY.displayName;var p=t(5331);let g=i.forwardRef((e,s)=>{let{className:t,children:r,...l}=e;return(0,a.jsxs)(p.fC,{ref:s,className:(0,x.cn)("relative overflow-hidden",t),...l,children:[(0,a.jsx)(p.l_,{className:"h-full w-full rounded-[inherit]",children:r}),(0,a.jsx)(j,{}),(0,a.jsx)(p.Ns,{})]})});g.displayName=p.fC.displayName;let j=i.forwardRef((e,s)=>{let{className:t,orientation:r="vertical",...l}=e;return(0,a.jsx)(p.gb,{ref:s,orientation:r,className:(0,x.cn)("flex touch-none select-none transition-colors","vertical"===r&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===r&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",t),...l,children:(0,a.jsx)(p.q4,{className:"relative flex-1 rounded-full bg-border"})})});j.displayName=p.gb.displayName;var v=t(2621),N=t(6763);function y(e){let{specialistId:s,caregiverId:t,caregiverName:m,onClose:x}=e,[h,p]=(0,i.useState)(""),[j,y]=(0,i.useState)(!1),[b,_]=(0,i.useState)([]),[w,k]=(0,i.useState)(!0),[S,C]=(0,i.useState)(null),{toast:D}=(0,v.pm)();(0,i.useEffect)(()=>{let e=!0,a=null,r=async()=>{try{let{data:r,error:l}=await N.OQ.rpc("get_or_create_chat_room",{p_specialist_id:s,p_caregiver_id:t});if(l)throw l;a=N.OQ.channel("room:".concat(r)).on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:"room_id=eq.".concat(r)},e=>{let t=e.new,a={id:t.message_id,room_id:t.room_id,sender_id:t.sender_id,content:t.content,created_at:t.created_at,updated_at:t.updated_at,edited:t.edited,deleted:t.deleted,read:t.read};a.sender_id!==s&&_(e=>[...e,a])}).subscribe(),C(a);let{data:i,error:d}=await N.OQ.rpc("chat_get_messages",{p_room_id:r});if(d)throw d;if(e){let e=(i||[]).map(e=>({id:e.message_id,room_id:e.room_id,sender_id:e.sender_id,content:e.content,created_at:e.created_at,updated_at:e.updated_at,edited:e.edited,deleted:e.deleted,read:e.read}));_(e),k(!1)}await N.OQ.rpc("chat_mark_messages_read",{p_room_id:r})}catch(s){console.error("Error loading messages:",s),e&&(D({variant:"destructive",title:"Error",description:"Failed to load messages"}),k(!1))}};return r(),()=>{e=!1,a&&a.unsubscribe()}},[s,t,D]);let E=async()=>{if(h.trim()){y(!0);try{let{data:e,error:a}=await N.OQ.rpc("get_or_create_chat_room",{p_specialist_id:s,p_caregiver_id:t});if(a)throw a;let{data:r,error:l}=await N.OQ.rpc("chat_save_message",{p_room_id:e,p_content:h.trim()});if(l)throw l;let i={id:r,room_id:e,sender_id:s,content:h.trim(),created_at:new Date().toISOString(),updated_at:new Date().toISOString(),edited:!1,deleted:!1,read:!1};_(e=>[...e,i]),p("")}catch(e){console.error("Error sending message:",e),D({variant:"destructive",title:"Error",description:"Failed to send message. Please try again."})}finally{y(!1)}}};return(0,a.jsx)("div",{className:"fixed inset-0 bg-background/80 backdrop-blur-sm z-50",children:(0,a.jsx)("div",{className:"fixed inset-4 bg-background rounded-lg shadow-lg border flex flex-col",children:(0,a.jsxs)(n.Zb,{className:"flex-1 flex flex-col relative",children:[(0,a.jsxs)(n.Ol,{className:"flex flex-row items-center justify-between pb-4 border-b",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(u,{className:"h-10 w-10 border-2 border-primary",children:(0,a.jsx)(f,{children:m[0]})}),(0,a.jsx)(n.ll,{className:"text-lg",children:m})]}),(0,a.jsx)(c.z,{variant:"ghost",size:"icon",onClick:x,children:(0,a.jsx)(r.Z,{className:"h-4 w-4"})})]}),(0,a.jsxs)(n.aY,{className:"flex-1 flex flex-col",children:[(0,a.jsx)(g,{className:"flex-1 p-4",children:w?(0,a.jsx)("div",{className:"text-center",children:"Loading messages..."}):0===b.length?(0,a.jsx)("div",{className:"text-center text-muted-foreground",children:"No messages yet."}):(0,a.jsx)("div",{className:"flex flex-col gap-4",children:b.map(e=>{let t=e.sender_id===s;return(0,a.jsxs)("div",{className:"flex items-start gap-2 ".concat(t?"flex-row-reverse":""," group"),children:[(0,a.jsx)(u,{className:"h-8 w-8",children:(0,a.jsx)(f,{children:t?"ME":m[0]})}),(0,a.jsxs)("div",{className:"flex flex-col ".concat(t?"items-end":""," gap-1 max-w-[80%] relative"),children:[(0,a.jsx)("div",{className:"\n                              px-4 py-2 rounded-2xl text-sm\n                              ".concat(t?"bg-primary text-primary-foreground rounded-tr-sm":"bg-muted rounded-tl-sm","\n                              group-hover:shadow-sm transition-shadow\n                            "),children:e.content}),(0,a.jsx)("span",{className:"text-xs text-muted-foreground",children:(0,d.ZP)(new Date(e.created_at),"h:mm a")})]})]},e.id)})})}),(0,a.jsxs)("div",{className:"p-4 border-t flex items-center gap-2 bg-card/95 backdrop-blur supports-[backdrop-filter]:bg-card/75",children:[(0,a.jsx)(o.I,{placeholder:"Type your message...",value:h,onChange:e=>p(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),E())},disabled:j,className:"bg-background"}),(0,a.jsx)(c.z,{size:"icon",variant:"default",onClick:E,disabled:j||!h.trim(),children:(0,a.jsx)(l.Z,{className:"h-4 w-4"})})]})]})]})})})}},4033:function(e,s,t){e.exports=t(290)}},function(e){e.O(0,[579,21,233,747,506,375,42,971,864,744],function(){return e(e.s=8714)}),_N_E=e.O()}]);