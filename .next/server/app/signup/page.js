(()=>{var e={};e.id=966,e.ids=[966],e.modules={5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},5528:e=>{"use strict";e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},1877:e=>{"use strict";e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},5319:e=>{"use strict";e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},4300:e=>{"use strict";e.exports=require("buffer")},6113:e=>{"use strict";e.exports=require("crypto")},2361:e=>{"use strict";e.exports=require("events")},3685:e=>{"use strict";e.exports=require("http")},5687:e=>{"use strict";e.exports=require("https")},1808:e=>{"use strict";e.exports=require("net")},5477:e=>{"use strict";e.exports=require("punycode")},2781:e=>{"use strict";e.exports=require("stream")},4404:e=>{"use strict";e.exports=require("tls")},7310:e=>{"use strict";e.exports=require("url")},9796:e=>{"use strict";e.exports=require("zlib")},812:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>n.a,__next_app__:()=>p,originalPathname:()=>m,pages:()=>u,routeModule:()=>x,tree:()=>d});var s=r(3137),i=r(4647),a=r(4183),n=r.n(a),o=r(1775),l={};for(let e in o)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>o[e]);r.d(t,l);let c=s.AppPageRouteModule,d=["",{children:["signup",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,7943)),"C:\\Users\\josej\\Downloads\\project-bolt-bolt-nextjs-shadcn-2hqv8hqk (3)\\project\\app\\signup\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,3253)),"C:\\Users\\josej\\Downloads\\project-bolt-bolt-nextjs-shadcn-2hqv8hqk (3)\\project\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,1918,23)),"next/dist/client/components/not-found-error"]}],u=["C:\\Users\\josej\\Downloads\\project-bolt-bolt-nextjs-shadcn-2hqv8hqk (3)\\project\\app\\signup\\page.tsx"],m="/signup/page",p={require:r,loadChunk:()=>Promise.resolve()},x=new c({definition:{kind:i.x.APP_PAGE,page:"/signup/page",pathname:"/signup",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},1827:(e,t,r)=>{Promise.resolve().then(r.bind(r,9453))},9453:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>b});var s=r(80),i=r(9885),a=r(7114),n=r(7099),o=r(3894),l=r(6558),c=r(9098),d=r(5705),u=r(9803),m=r(327),p=r(8384),x=r(806),h=r(9424),f=r(7502),g=r(7988),v=r(3161),j=r(2730);let w=(0,j.createClient)("https://xuqkgeusasosxtcfhbwj.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inh1cWtnZXVzYXNvc3h0Y2ZoYndqIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTczNjMwODU5NSwiZXhwIjoyMDUxODg0NTk1fQ.mDgADwthCJGMesU6F6-ui9XfLw7DGoA06k66mGEAGKU",{auth:{autoRefreshToken:!0,persistSession:!1},db:{schema:"public"}}),y=c.Ry({name:c.Z_().min(2,"Name must be at least 2 characters"),email:c.Z_().email("Please enter a valid email address"),password:c.Z_().min(8,"Password must be at least 8 characters").regex(/[A-Z]/,"Password must contain at least one uppercase letter").regex(/[a-z]/,"Password must contain at least one lowercase letter").regex(/[0-9]/,"Password must contain at least one number"),confirmPassword:c.Z_()}).refine(e=>e.password===e.confirmPassword,{message:"Passwords don't match",path:["confirmPassword"]});function b(){let e=(0,a.useRouter)(),t=(0,a.useSearchParams)(),{toast:r}=(0,f.pm)(),[c,j]=(0,i.useState)(!1),[b,I]=(0,i.useState)(!0),[_,P]=(0,i.useState)(null),[q,N]=(0,i.useState)(null),[C,E]=(0,i.useState)(""),k=t.get("invitation_id"),A=k&&(0,v.z)(k)?k:null,S=t.get("email");(0,i.useEffect)(()=>{E(window.location.href)},[]),(0,i.useEffect)(()=>(v.f.info("CaregiverSignupPage mounted",{invitationId:A,invitedEmail:S,url:C,searchParams:Object.fromEntries(t.entries())}),()=>{v.f.info("CaregiverSignupPage unmounted")}),[A,S,C,t]),v.f.info("URL parameters:",{rawInvitationId:k,invitationId:A,invitedEmail:S,url:C,searchParams:Object.fromEntries(t.entries())});let U=(0,l.cI)({resolver:(0,o.F)(y),defaultValues:{name:"",email:S?decodeURIComponent(S):"",password:"",confirmPassword:""}});(0,i.useEffect)(()=>{(async function(){if(v.f.info("Starting invitation validation",{invitationId:A,invitedEmail:S}),!A||!S){v.f.warn("Missing invitation parameters",{invitationId:A,invitedEmail:S}),P("Invalid invitation format"),I(!1);return}try{v.f.info("Validating invitation:",{invitationId:A,invitedEmail:S}),v.f.info("Invitation query details:",{invitationId:A,invitedEmail:S,decodedEmail:decodeURIComponent(S),isValidUUID:(0,v.z)(A)});let{data:e,error:t}=await w.from("caregiver_invitations").select(`
            id,
            email,
            name,
            status,
            expires_at,
            specialists (
              name,
              business_name
            )
          `).eq("id",A).eq("email",S).single();if(v.f.info("Query result:",{hasData:!!e,data:e,error:t}),t)throw v.f.error("Invitation query failed",{error:t,invitationId:A,status:t.code,message:t.message,details:t.details}),Error("Invitation not found");if(e.email!==decodeURIComponent(S))throw v.f.warn("Email mismatch in invitation",{invitationEmail:e.email,providedEmail:decodeURIComponent(S)}),Error("Invalid invitation email");v.f.info("Raw invitation data received:",e);let r={...e,specialists:Array.isArray(e.specialists)?e.specialists[0]:e.specialists};if("accepted"===r.status)throw v.f.warn("Attempt to use already accepted invitation",{invitationId:A,status:r.status}),Error("This invitation has already been used");if(r.expires_at&&new Date(r.expires_at)<new Date)throw v.f.warn("Attempt to use expired invitation",{invitationId:A,expiresAt:r.expires_at}),Error("This invitation has expired");v.f.info("Invitation is valid:",r),N(r.specialists?.business_name||r.specialists?.name||null),r.name&&U.setValue("name",r.name),I(!1)}catch(e){v.f.error("Invitation validation failed",{error:e,invitationId:A,invitedEmail:S}),P(e instanceof Error?e.message:"Invalid invitation"),I(!1)}})()},[A,S,U]);let Z=async t=>{if(v.f.info("Starting form submission",{email:t.email,name:t.name,invitationId:A}),!A){v.f.error("Missing invitationId during form submission"),r({variant:"destructive",title:"Error",description:"Invalid invitation"});return}j(!0);try{let{data:s,error:i}=await g.OQ.rpc("check_user_exists",{p_email:t.email});if(i)throw v.f.error("User lookup failed",{error:i}),i;if(s)throw v.f.info("User already exists"),Error("An account with this email already exists");v.f.info("Creating new auth account");let{data:a,error:n}=await g.OQ.auth.signUp({email:t.email,password:t.password,options:{data:{name:t.name,role:"caregiver"}}});if(n)throw v.f.error("Auth signup failed",{error:n}),n;if(!a.user)throw v.f.error("Auth signup returned no user"),Error("Failed to create account");v.f.info("Calling handle_caregiver_signup RPC",{userId:a.user.id,invitationId:A});let{error:o}=await g.OQ.rpc("handle_caregiver_signup",{p_user_id:a.user.id,p_invitation_id:A});if(o)throw v.f.error("RPC call failed",{error:o}),o;v.f.info("Signup process completed successfully"),r({title:"Account created",description:"Your caregiver account has been created successfully. Please check your email to verify your account."}),e.push("/login/caregiver")}catch(e){v.f.error("Signup process failed",{error:e,email:t.email,invitationId:A}),r({variant:"destructive",title:"Error",description:e instanceof Error?e.message:"Failed to create account"})}finally{j(!1)}};return b?s.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:(0,s.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[s.jsx(d.Z,{className:"h-8 w-8 animate-spin text-primary"}),s.jsx("p",{className:"text-muted-foreground",children:"Validating your invitation..."})]})}):_?s.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:s.jsx("div",{className:"max-w-md w-full px-4",children:(0,s.jsxs)(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},className:"bg-card rounded-lg shadow-lg p-6 text-center",children:[s.jsx("h1",{className:"text-2xl font-bold text-destructive mb-4",children:"Invalid Invitation"}),s.jsx("p",{className:"text-muted-foreground mb-6",children:_}),s.jsx(p.z,{onClick:()=>e.push("/"),children:"Return Home"})]})})}):s.jsx("div",{className:"min-h-screen bg-background",children:s.jsx("div",{className:"max-w-md mx-auto pt-16 px-4",children:(0,s.jsxs)(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},className:"w-full overflow-hidden rounded-xl shadow-xl p-6 bg-card",children:[(0,s.jsxs)("div",{className:"mb-8",children:[(0,s.jsxs)(p.z,{variant:"ghost",onClick:()=>e.push("/"),className:"inline-flex items-center text-sm mb-6 text-muted-foreground hover:text-foreground",children:[s.jsx(u.Z,{className:"mr-2 h-4 w-4"}),"Back to Home"]}),(0,s.jsxs)("div",{className:"text-center",children:[s.jsx("div",{className:"inline-flex items-center justify-center w-12 h-12 rounded-full bg-primary/10 mb-4",children:s.jsx(m.Z,{className:"h-6 w-6 text-primary"})}),s.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"Create Your Caregiver Account"}),q&&(0,s.jsxs)("p",{className:"mt-2 text-muted-foreground",children:["Join ",q,"'s sleep consultation practice"]})]})]}),s.jsx(x.l0,{...U,children:(0,s.jsxs)("form",{onSubmit:U.handleSubmit(Z),className:"space-y-6",children:[s.jsx(x.Wi,{control:U.control,name:"name",render:({field:e})=>(0,s.jsxs)(x.xJ,{children:[s.jsx(x.lX,{children:"Full Name"}),s.jsx(x.NI,{children:s.jsx(h.I,{placeholder:"Enter your name",...e})}),s.jsx(x.pf,{children:"This is how you'll appear to your sleep specialist"}),s.jsx(x.zG,{})]})}),s.jsx(x.Wi,{control:U.control,name:"email",render:({field:e})=>(0,s.jsxs)(x.xJ,{children:[s.jsx(x.lX,{children:"Email"}),s.jsx(x.NI,{children:s.jsx(h.I,{type:"email",placeholder:"Enter your email",disabled:!0,...e})}),s.jsx(x.pf,{children:"This is the email where you received the invitation"}),s.jsx(x.zG,{})]})}),s.jsx(x.Wi,{control:U.control,name:"password",render:({field:e})=>(0,s.jsxs)(x.xJ,{children:[s.jsx(x.lX,{children:"Password"}),s.jsx(x.NI,{children:s.jsx(h.I,{type:"password",placeholder:"Create a password",...e})}),s.jsx(x.pf,{children:"Must be at least 8 characters with uppercase, lowercase, and numbers"}),s.jsx(x.zG,{})]})}),s.jsx(x.Wi,{control:U.control,name:"confirmPassword",render:({field:e})=>(0,s.jsxs)(x.xJ,{children:[s.jsx(x.lX,{children:"Confirm Password"}),s.jsx(x.NI,{children:s.jsx(h.I,{type:"password",placeholder:"Confirm your password",...e})}),s.jsx(x.zG,{})]})}),s.jsx(p.z,{type:"submit",className:"w-full",disabled:c,children:c?(0,s.jsxs)(s.Fragment,{children:[s.jsx(d.Z,{className:"mr-2 h-4 w-4 animate-spin"}),"Creating Account..."]}):"Create Caregiver Account"})]})})]})})})}},7943:(e,t,r)=>{"use strict";r.r(t),r.d(t,{$$typeof:()=>n,__esModule:()=>a,default:()=>l});var s=r(7536);let i=(0,s.createProxy)(String.raw`C:\Users\josej\Downloads\project-bolt-bolt-nextjs-shadcn-2hqv8hqk (3)\project\app\signup\page.tsx`),{__esModule:a,$$typeof:n}=i,o=i.default,l=o}};var t=require("../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[671,725,99,672,912,627,211,806],()=>r(812));module.exports=s})();